<!DOCTYPE html>
<html lang="en">

<head>
    <title>COLMARvista1D</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="colmarview.css">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TWNDSX3RVS"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-TWNDSX3RVS');
</script>


<body>
    <div id="navbar-placeholder"></div>

    <div id="body">

        <span id="contour_message"></span>
        <span id="webassembly_message"></span>

        <div id="section1" style=" Padding: 10px; width: 100%">
            <div>
                <h1>COLMARvista 1D: a browser based 1D NMR viewer</h1>
                <h2>For automatic processing, peak picking, peak fitting, and pseudo-2D fitting</h2>
                <h3><a id="instructions_link" target="_blank" rel="noopener noreferrer"
                        href="https://github.com/lidawei1975/colmarviewer/wiki">Instructions</a>
                    <button id="button_tutorial" onclick="startTutorial()"
                        style="background-color: #ff9800; color: white;">Tutorial</button>
                </h3>
            </div>
        </div>

        <div id="section2">

            <div id="load_and_save" class="drop-area-neighbor" style="width: 1200px; overflow: clip; height: 3rem;">
                <label for="button_save" id="button_save_label">Save current session to a local file </label>
                <button id="button_save" onclick="save_to_file()">save</button>
                <br>
                <label id="load_file_label" for="load_file">Load previous session: </label>
                <input type="file" id="load_file" accept=".save, .colmar">
                <br>
            </div>

            <div id="fid_file_area" class="drop-area-neighbor" style="width: 1200px; overflow: clip; height: 3rem;">
                <span>
                    <p><button id="button_minimize_fid_area" onclick="minimize_fid_area(this)">+</button>Bruker time
                        domain data for processing: <span class="information">(Console version >=3.0) </span>
                    </p>
                </span>
                <form id="fid_file_form" action="" enctype="multipart/form-data">
                    <div class="drop-area input-section" id="input_files">
                        <label for="fid_file">fid file (required, usually called fid or ser): </label><input type="file"
                            name="fid_file" id="fid_file" multiple><br>
                        <label for="acquisition_file">Direct dimension acquisition file (required, usually called
                            acqus):</label>
                        <input type="file" name="acquisition_file" id="acquisition_file"><br>
                        <span class="information"> You can also drag and drop Bruker folder (which contains required
                            files here).</span><br>
                    </div>

                    <div class="input-section" id="input_options">
                        <span>
                            <label for="spectral_width_direct">Reduce FID size to (in Bruker conversion, 0 means no
                                reduction):</label>
                            <input type="number" name="reduced_fid_size" id="reduced_fid_size" value="0" step="1">
                            <label for="auto_reduced_fid_size">Auto</label>
                            <input type="checkbox" name="auto_reduced_fid_size" id="auto_reduced_fid_size" value="yes"
                                checked>
                            <label for="reduced_fid_size_confirm">with user confirmation</label>
                            <input type="checkbox" name="reduced_fid_size_confirm" id="reduced_fid_size_confirm"
                                value="yes">
                        </span>
                        <span>
                            <label for="apodization_direct">Apodization function</label>
                            <input type="text" name="apodization_direct" id="apodization_direct"
                                value="SP off 0.5 end 0.98 pow 2 elb 0 c 0.5" size="50">
                        </span>

                        <span>
                            <label for="zf_direct">Zero filling factor (2, 4, 8): </label>
                            <select name="zf_direct" id="zf_direct">
                                <option value="2">2</option>
                                <option value="4" selected>4</option>
                                <option value="8">8</option>
                            </select>
                        </span>

                        <span>
                            <label for="phase_correction_direct_p0">Phase correction P0:
                            </label>
                            <input type="number" name="phase_correction_direct_p0" id="phase_correction_direct_p0"
                                value="0" step="any">
                            <label for="phase_correction_direct_p1">P1: </label>
                            <input type="number" name="phase_correction_direct_p1" id="phase_correction_direct_p1"
                                value="0" step="any">
                            <fieldset>
                                <legend>Phase correction:</legend>
                                <input type="radio" name="pc_method" id="auto_direct" value="1">
                                <label for="auto_direct">Peak centric CNN</label>
                                <input type="radio" name="pc_method" id="auto_direct_2" value="2" checked>
                                <label for="auto_direct_2">Full spectrum ANN</label>
                                <input type="radio" name="pc_method" id="auto_direct_3" value="3">
                                <label for="auto_direct_3">Entropy based</label>
                                <input type="radio" name="pc_method" id="manual" value="0">
                                <label for="manual">Manual</label>
                            </fieldset>
                            <input type="checkbox" name="delete_imaginary" id="delete_imaginary" value="yes" hidden>
                            <!-- <label for="delete_imaginary">Delete imaginary data after FT</label> -->
                        </span>

                        <span>
                            <input type="radio" name="Pseudo-2D-process" id="first_only" value="first_only" checked>
                            <label for="first_only">Process the first 1D experiment only</label>
                            <input type="radio" name="Pseudo-2D-process" id="all_traces" value="all_planes">
                            <label for="all_planes">Process all pseudo 2D traces</label>
                        </span>
                    </div>
                    <input type="submit" id="button_fid_process" name="button_fid_process"
                        value="Upload experimental files and process">
                    </br>

                </form>
            </div>


            <div id="file_area" class="drop-area" style="width: 1200px;">
                <p><button id="button_minimize_file_area" onclick="minimize_file_area(this)">-</button>Frequency
                    domain spectra:</p>
                <form id="ft1_file_form" action="" enctype="multipart/form-data">
                    <label for="userfile">Frequency domain spectral file (.ft1, .ucsf or .txt) </label><input
                        type="file" multiple id="userfile"><br>
                    <input type="submit" id="button_ft1_process" value="Upload and process spectra"></br>
                </form>
                <span class="information"> You can also drag and drop spectral file(s) in nmrPipe format or folder
                    contains them here.</span>
            </div>


            <div id="spectra_list" style=" Padding: 10px; width: 1200px;" class="drop-area-neighbor">
                <h4>Your spectra list:</h4>
                <ol id="spectra_list_ol" type="1">
                </ol>
            </div>


            <div class="flex-container">


                <div id="plot" class="drop-area-neighbor" style=" Padding: 10px;">

                    <div>
                        <strong>Control:</strong>
                        <label for="plot_group">Plot group </label>
                        <input type="number" id="plot_group" value="1" min="1" max="10">
                        <button onclick="download_plot()">Download plot</button>
                        <button onclick="write_current_size()">Fill plot size and zoom</button>
                        <input type="text" id="size_and_zoom_string" placeholder="size and zoom level of plot"
                            style="width: 300px;">
                        <button onclick="apply_size_and_zoom()">Apply plot size and zoom</button>
                        <label for="fontsize"> Font size: </label>
                        <input type="number" id="fontsize" value="24" min="8" max="72">
                        <button onclick="apply_font_size()">Apply</button>
                        <br>

                        <button id="button_auto_pc" onclick="run_auto_pc()">Run automatic phase correction</button>
                        <button id="button_apply_pc" onclick="permanently_apply_phase_correction()">Apply manual phase
                            correction</button>
                        Pivot: <span id="pivot"> Not set </span>
                        Phase correction at left end: <span id="pc_left_end"> 0 </span>, at right end: <span
                            id="pc_right_end"> 0 </span>.
                        <br>

                        <label for="smooth_parameter">Baseline smooth parameter(8-15): </label>
                        <input type="number" id="smooth_parameter" value="11" min="6" max="16">&nbsp;&nbsp;
                        <label for="exclude_water">Exclude water suppression region </label>
                        <input type="checkbox" id="exclude_water" checked>
                        <button id="button_baseline_correction" onclick="run_baseline_correction()">Calculate
                            baseline</button>
                        <button id="button_apply_baseline_correction" onclick="apply_baseline_correction()">Apply
                            baseline correction</button>
                        <br>

                        <label for="peak_size">Peak size: </label>
                        <input type="number" id="peak_size" value="4" min="1" max="20">&nbsp;&nbsp;
                        <label for="peak_thickness">Thickness: </label>
                        <input type="number" id="peak_thickness" value="1" min="1" max="10">
                        <input type="checkbox" id="filled_peaks" checked>
                        <label for="filled_peaks"> Filled peak</label>
                        <label for="peak_color"> color </label>
                        <input type="color" id="peak_color" value="#0000ff">&nbsp;&nbsp;
                        <input type="checkbox" id="allow_drag_and_drop" disabled>
                        <label for="allow_drag_and_drop"> Drag and drop to move (or remove) peak.</label>
                        <br>
                    </div>


                    <!-- This is the main plot -->
                    <div id="plot_1d" class="resizable" style="display: none;">
                        <!-- The SVG based plot will be generated here -->
                    </div>

                    <div id="plot_1d_instructions">
                        <h4>Instructions:</h4>
                        <p>Use wheel to zoom in and out along the frequency axis (when cursor is over the plot area) or
                            along the vertical axis (when cursor is on the left of the Y-axis).
                        </p>
                        <p>Click and drag to pan the plot.</p>
                        <p>Hold Alt then drag to referencing or use wheel to rescale the current spectrum, while keep
                            others fixed.</p>
                        <p>Hold Shift (rough) or Control(fine) then use wheel to adjust P0 (with pivot unset) or P1
                            phase (with pivot set).</p>
                        <p>Use right click to set/unset pivot point. </p>
                    </div>
                </div>
            </div>

            <div id="peak_area" class="resizable scroll" style="min-width: 400px; min-height: 300px; display: none;">
                <div id=" peak_area_header" class="header_sticky">
                    <label for="peak_search_text">Search in peaks </label>
                    <input type="text" id="peak_search_text" placeholder="peak text">
                    <button id="peak_search" onclick="search_peak()">Search</button>
                </div>
                <table id="peak_table">
                    <!-- table content will be managed by JS code -->
                </table>
            </div>

        </div>

        <div id="log_area" class="drop-area-neighbor" style="width: min-content;">
            <h4>Background server log:</h4>
            <textarea id="log" rows="50" cols="120" readonly></textarea>
            <button onclick="clear_log()">Clear log</button>
            <button onclick="download_log()">Download log</button>
        </div>

    </div>

    <div id="footer" style="width: 1200px;">
        <p>For questions or comments, please contact us at <a href="mailto:lidawei@gmail.com">lidawei@gmail.com</a></p>
    </div>

    <!-- Hidden pop up div -->
    <div id="peak_information_div" class="popup_div" style="display: block">
        <div id="pseudo3d_fitting_plot"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script type="text/javascript" src="js/d3.7.min.js"></script>
    <script type="text/javascript" src="js/ldwmath.js"></script>
    <script type="text/javascript" src="js/file_drop.js"></script>
    <script type="text/javascript" src="js/peaks.js"></script>
    <script type="text/javascript" src="js/spectrum_1d.js"></script>
    <script type="text/javascript" src="js/myplot/myplot_1d.js"></script>
    <script type="text/javascript" src="js/make_table.js"></script>
    <script type="text/javascript" src="js/tutorial.js"></script>
    <script type="text/javascript" src="js/1d.js"></script>
    </div>
</body>

</html>